{{ define "styles" }}
  <style>
    a:link, a:visited {
      text-decoration: none;
      cursor: pointer;
    }
    .btn {
      cursor: pointer;
    }
  </style>
{{ end }}

{{ define "content" }}

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-900">Hardwares</h1>
    </div>

    <!-- Content Row -->
    <div class="row">
      <div class="col-lg-4">
        <!-- Hardware List -->
        <div class="card shadow mb-4">
          <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Hardwares</h6>
          </div>

          <div class="container" id="hardware-list">
            {{ with .Hardwares }} 
              {{ range . }}
                <div class="card shadow mb-4" id="card-{{.ID}}" >
                  <!-- Card Header - Accordion -->
                  <a href="#hw-{{.ID}}" class="d-block card-header py-3 collapsed" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="hw-{{.ID}}">
                    <h6 class="m-0 font-weight-bold" style="color: rgb(142, 40, 6);">{{ .ID }}</h6>
                  </a>
                  <!-- Card Content - Collapse -->
                  <div class="collapse" id="hw-{{.ID}}" data-id="{{.ID}}" data-parent="#hardware-list">
                    <div class="card-body">
                      {{ range $key, $value := .Fields }}
                        <div>
                          <strong>{{ $key }}: </strong><span class="float-right">{{ $value }}</span>
                        </div>
                      {{ end }}
                    </div>
                  </div>
                </div>
              {{ end }}
            {{ end }}
          </div>
        </div>
      </div> <!-- end col hardware list -->

      <div class="col-lg-6">
        <!-- Hardware Data -->
        <div class="card shadow mb-4">
          <!-- Card Header - Dropdown -->
          <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
            <h6 class="m-0 font-weight-bold text-primary">Hardware Data</h6>
            <div>
              <a id="edit-hardware" class="btn" style="display: none;" onclick="allowHardwareEdit()"><i class="fas fa-edit text-success"></i></a>
              <a id="update-hardware" class="btn" style="display: none;" onclick="updateHardware()"><i class="fas fa-file-upload text-warning"></i></a>
              <a id="cancel-edit" class="btn" style="display: none;" onclick="cancelEdit()"><i class="fas fa-times text-danger"></i></a>
              <a id="delete-hardware" class="btn" style="display: none;" onclick="deleteHardware()">Delete</a>
            </div>
          </div>

          <!-- Card Body -->
          <div class="card-body">
            <div class="position-relative form-group apply_space" style="height:85%;">
              <textarea readonly class="form-control codemirror-textarea" id="hardware-data" rows="25" 
                  style="border: none; background-color: #fff;">
              </textarea>
            </div>
          </div>
          <!-- <script>
            var editor = CodeMirror.fromTextArea(document.getElementById("hardware-data"), {
              matchBrackets: true,
              autoCloseBrackets: true,
              mode: {name: "javascript", json: true},
              lineWrapping: true
            });
          </script> -->

        </div>
      </div> <!-- end col hardware data -->
    </div> <!-- row end -->

{{end}}

{{ define "scripts" }}
  <script type="text/javascript" src="/plugin/codemirror/lib/codemirror.js"></script>
  <script src="/plugin/codemirror/mode/javascript/javascript.js"></script>  
  <script>
    updateNavbar("hw-list", "collapseHardware");

    let currentHardwareId = "";
    let orgData = "";

    $(".card .collapse")
      .on("show.bs.collapse", selectHardware)
      .on("hide.bs.collapse", deselectHardware);

    function startState() {
      $('#hardware-data').prop('readonly', true);
      $('#edit-hardware').css("display", "none");
      $('#update-hardware').css("display", "none");
      $('#cancel-edit').css("display", "none");
      $('#delete-hardware').css("display", "none");
    }

    function readState() {
      $('#hardware-data').prop('readonly', true);
      $('#edit-hardware').css("display", "inline");;
      $('#update-hardware').css("display", "none");
      $('#cancel-edit').css("display", "none");
      $('#delete-hardware').css("display", "inline");
    }

    function editState() {
      $('#hardware-data').prop('readonly', false);
      $('#edit-hardware').css("display", "none");
      $('#update-hardware').css("display", "inline");
      $('#cancel-edit').css("display", "inline");
      $('#delete-hardware').css("display", "inline");
    }

    function allowHardwareEdit() {
      orgData = $('#hardware-data').val();
      editState();
    }

    function cancelEdit() {
      $('#hardware-data').val(orgData);
      readState();
    }

    function updateHardware() {
      newData = $('#hardware-data').val();
      $.ajax({
        'url' : '/hardware/update',
        'type' : 'POST',
        'data' : JSON.stringify({ id: currentHardwareId, data: newData}),
        'success' : function(data) { 
          displayAlert("", data, "success");
          // TODO: Update list card data with new variables data!
          readState();
        },
        'error' : function(jqXHR) {
          if (jqXHR.status == 400 || jqXHR.status == 404) {
            displayAlert(jqXHR.status, jqXHR.responseText, "danger");
          } else {
            displayAlert(jqXHR.status, "Something went wrong! Please report this to https://github.com/gauravgahlot/tink-wizard/issues", "danger");
          }
        }
      });
    }

    function selectHardware(event) {
      var id=$(event.delegateTarget).data("id");
      $.ajax({
        'url' : '/hardware',
        'type' : 'POST',
        'data' : JSON.stringify({ id: id}),
        'success' : function(data) {
          currentHardwareId = id;
          document.getElementById("hardware-data").value = JSON.stringify(data, undefined, 4);
          readState();
        },
        'error' : function(jqXHR) {
          if (jqXHR.status == 400 || jqXHR.status == 404) {
            displayAlert(jqXHR.status, jqXHR.responseText, "danger");
          } else {
            displayAlert(jqXHR.status, "Something went wrong! Please report this to https://github.com/tinkerbell/portal/issues", "danger");
          }
          currentHardwareId = "";
          document.getElementById("hardware-data").value = "";
          startState();
        }
      });
    }

    function deselectHardware(event) {
      currentHardwareId = "";
      document.getElementById("hardware-data").value = "";
      startState();
    }

    function deleteHardware() {
      $.ajax({
        'url' : '/hardware/delete',
        'type' : 'POST',
        'data' : JSON.stringify({ id: currentHardwareId}),
        'success' : function(data) {
          displayAlert("", data, "success");
          $('#card-'+currentHardwareId).remove();
          currentHardwareId = "";
          document.getElementById("hardware-data").value = "";
          startState();
        },
        'error' : function(jqXHR) {
          if (jqXHR.status == 400 || jqXHR.status == 404) {
            displayAlert(jqXHR.status, jqXHR.responseText, "danger");
          } else {
            displayAlert(jqXHR.status, "Something went wrong! Please report this to https://github.com/tinkerbell/portal/issues", "danger");
          }
          currentHardwareId = "";
          document.getElementById("hardware-data").value = "";
          startState();
        }
      });
    }
  </script>
{{ end }}